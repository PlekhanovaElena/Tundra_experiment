{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Identity within plots for soil variables\"\noutput:\n  html_document:\n    code_folding: hide\n  html_notebook: default\n  pdf_document: default\n---\n\nHere we present analysis of the \"insitu\" sheet of \"soil_variables_DPE\" table. The table represents data for the \"Soil pH at 10cm depth\", \"Soil temperature, °C\", \"Active layer thickness, cm\" and \"Air temperature, °C\" variables. Each variable representad by 5 observations within each of 3 blocks within each of 10 blocks.\n\nWe want to test if there are any significant differences within plots of each of the block. Besides, it is interesting, is there any significant differences in these variables between ridge and lakebed locations.\n\n```{r, message=FALSE, warning=FALSE}\nlibrary(xlsx)\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(plyr)\nsource(\"./functions.R\")\n```\n```{r, message=FALSE, warning=FALSE}\nins_path <- \"/home/lena/Tundra_exp/soil_variables_DPE.xlsx\"\nins <- read.xlsx(ins_path, 1)  # read first sheet\n\nclmn = colnames(ins) %in% c(\"Blk\", \"Plot.\", \"Air.temperature...C.\", \"Soil_pH_10cm_depth\", \"Soil_temp_degC\", \"ALT_cm\")\nins = ins[!is.na(ins$Blk),clmn]\ncolnames(ins) = c(\"block\", \"plot\", \"air_temp\", \"soil_pH\", \"soil_temp\", \"ALT_cm\")\nynames = colnames(ins)[3:ncol(ins)]\nvarnames = c(\"Air temperature, °C\", \"Soil pH at 10cm depth\", \"Soil temperature, °C\", \"Active layer thickness, cm\")\nn_samp = 5              # number of observations in each plot\nrm(clmn, ins_path)\n```\n\n\n# Statistical tests\n\nIn order to test differences within plots, we perform ANOVA for plots that meet ANOVA's assumptions and Kruskal-Wallis for others\n\n```{r}\ntest = sapply(c(4:ncol(ins)), function(cl) {\n  # ANOVA test\n  anpv = sapply(c(0:9), function(x) {\n    inexes_within_block = (1 + n_samp*3*x):(n_samp*3*x+n_samp*3)\n    plant.mod1 = lm(paste0(colnames(ins)[cl],\" ~ plot\"), data = ins[ inexes_within_block ,])\n    res = anova(plant.mod1)$`Pr(>F)`                                   # results of ANOVA\n    res[2] = shapiro.test(residuals(plant.mod1))$p.value               # normality of residuals\n    res[3] = bartlett.test(ins[ inexes_within_block ,cl], \n                           ins$plot[ inexes_within_block ])$p.value    # homogeneity of variances\n    return(res)\n  })\n  non_anova_blocks = which((anpv[2, ] < 0.05) | (anpv[3, ] < 0.05))    # block's numbers that do not meet\n                                                                       # ANOVA's assumptions\n  # Kruskal-Wallis for non-normal residuals\n  krpv = sapply( non_anova_blocks , function(x) kruskal.test(ins[(1 + n_samp*3*x):(n_samp*3*x+n_samp), cl], ins[(1 +   n_samp*3*x + n_samp):(n_samp*3*x+n_samp*2), cl], ins[(1 + n_samp*3*x + n_samp*2):(n_samp*3*x+n_samp*3), cl])$p.value)\n  \n  # Result for ANOVA for normal residuals and Kruskal-Wallis for non-normal residuals\n  n_of_sign_diff = sum(anpv[1,!non_anova_blocks] <0.05) + sum(krpv < 0.05)\n  \n  print(paste0(\"There are significant differences within \", n_of_sign_diff, \" blocks of '\", varnames[cl-2], \"' variable\"))\n})\n```\n\nAs for the \"Air temperature, °C\" variable, there are equal values of observations within each block, except for the 8th, where temperature of P22 plot is 0.1°C different from two other plots (P23, P24):\n```{r}\nins[ins$block == \"BLK08\",c(1,2,3)]\n```\nThis difference is, of corse, statistically significant, but this slight divation of air temperature is not likely to influence the experiment. \n\nIn order to test differences between means of variables in ridge and lakebed locations we perform Mann-Whitney-Wilcoxon test.\nThe diffenences are significant for variables:\n```{r}\nridge_indexes = ins$block %in% levels(ins$block)[1:5]\nmwpv = sapply(c(3:6), function(cl) wilcox.test(ins[ridge_indexes, cl], ins[!ridge_indexes,cl],  exact = F)$p.value)\nvarnames[which(mwpv < 0.05)]\n```\n\n\n## Graphical representation of differences within plots and between plots\n\n\nOn the figure each dot represents the mean of the variable within plot (top) or block (bottom), vertical lines represent confidance intervals. The top plot for each variable shows variation within each block, while the bottom plot shows variation between blicks. The dashed lines display the means of variables\n```{r, fig.height=20, fig.width=10, message=FALSE, warning=FALSE}\nplot_list <- lapply(c(1:4), function(n) plot_diff(ins, ynames[n], varnames[n]))\ncowplot::plot_grid(plotlist=plot_list, ncol=1)\n```\n\n# Conclusion\n\nThere are no significant differences for soil variables within plots. However, the air temperature has 0.1 difference in one of the plot of 8th block. We also observed significant differences between blocks in ridge and lakebed locations for the \"Air temperature, °C\", \"Soil temperature, °C\" and \"Active layer thickness, cm\" variables.\n\n",
    "created" : 1522827848118.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4047856152",
    "id" : "564252A8",
    "lastKnownWriteTime" : 1523017186,
    "last_content_update" : 1523017186805,
    "path" : "~/Tundra_exp/R_code/Identical_plots_plants.Rmd",
    "project_path" : "Identical_plots_plants.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}